<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Targets</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='dashboard.css') }}">
</head>
<body>
  <div class="layout">
    <aside class="left-sidebar">
      <section class="section">
        <h3>Home</h3>
        <div class="button-group">
             <!-- main navigation links -->
          <a class="item" href="{{ url_for('main_dashboard') }}">Dashboard</a>
          <a class="item is-selected" href="{{ url_for('targets') }}">targets</a>
          <a class="item" href="{{ url_for('experiment_builder') }}">new experiment</a>
          <a class="item" href="{{ url_for('profile') }}">profile</a>
        </div>
      </section>
    </aside>

    <!-- page header -->
    <main class="main">
      <header class="topbar">
        <div>
          <h1>Targets</h1>
          <p class="sub">add targets for your account only</p>
        </div>
      </header>

      <!-- flash messages (success, errors, etc.) -->
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          <div style="margin-top:12px;">
            {% for cat, msg in messages %}
              <div class="tag {% if cat=='success' %}ok{% endif %}" style="margin-right:8px;">{{ msg }}</div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      <!-- ADD TARGET FORM -->
      <div class="panel" style="margin-top:16px;">
        <form method="post" class="form-grid">
          <label class="field">
            <span>name</span>
            <input name="name" placeholder="localtestapp" required>
          </label>

          <!-- target IP or URL -->
          <label class="field">
            <span>ip_or_url</span>
            <input name="ip_or_url" placeholder="http://127.0.0.1:5001" required>
          </label>

          <div class="actions">
            <a class="btn-secondary" href="{{ url_for('main_dashboard') }}">back</a>
            <button class="btn-primary" type="submit">add</button>
          </div>
        </form>
      </div>

      <!-- LIST OF EXISTING TARGETS -->
      <div class="panel" style="margin-top:16px;">
        <h2 style="margin:0 0 10px 0; font-size:16px;">Your targets</h2>

        {% if targets|length == 0 %}
          <p style="color: var(--muted);">No targets yet</p>
        {% else %}
          {% for t in targets %}
            <div class="item" style="display:flex; justify-content:space-between; align-items:center;">
              <div>
                <b>{{ t.name }}</b><br>
                <span style="color:var(--muted); font-size:12px;">{{ t.ip_or_url }}</span>
              </div>
              <!-- consent status pill -->
              <span class="pill">{{ t.consent_status }}</span>
            </div>
          {% endfor %}
        {% endif %}
      </div>
    </main>
  </div>
</body>
</html>
